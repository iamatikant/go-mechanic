{"ast":null,"code":"import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { forwardRef, useCallback, useContext, useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport ComboBox from '../ComboBox';\nimport { useI18n, useTestIds } from '../../hooks';\nimport { createUID } from '../../utils';\nimport FormField from '../FormField';\nimport Flex from '../Flex';\nimport PoweredByGoogleImage from './PoweredByGoogleImage';\nimport CurrentLocationButton from './CurrentLocationButton';\nimport MapsContext from './MapsContext';\nimport { getPlaceById, getPlacePredictions, loadMapsAPI } from './utils';\nimport LocationView, { StyledLocationView } from './LocationView';\nimport { getLocationInputTestIds } from './Location.test-ids';\nconst StyledLocationMap = styled.div`\n  ${StyledLocationView} {\n    border-top-left-radius: 0;\n    border-top-right-radius: 0;\n  }\n`;\nconst LocationInput = forwardRef((props, ref) => {\n  const {\n    testId,\n    label,\n    labelHidden,\n    id = createUID(),\n    location = '',\n    value = '',\n    info,\n    status,\n    required,\n    readOnly,\n    disabled,\n    additionalInfo,\n    onSelect,\n    onError,\n    onChange,\n    bias,\n    showMap,\n    defaultToCurrentLocation,\n    centerMapOnChange,\n    height,\n    zoomLevel,\n    onClick,\n    onBlur,\n    ...restProps\n  } = props;\n  const testIds = useTestIds(testId, getLocationInputTestIds);\n  const {\n    name,\n    ...providerOpts\n  } = useContext(MapsContext);\n  const t = useI18n();\n  const [placePredictionMenu, setPlacePredictionMenu] = useState({\n    items: []\n  });\n  const [filterValue, setFilterValue] = useState('');\n  useEffect(() => {\n    const mapApiPromise = loadMapsAPI(name, providerOpts).catch(error => onError?.(error));\n    if (filterValue) {\n      mapApiPromise.then(() => getPlacePredictions(filterValue, bias)).then(_ref => {\n        let {\n          placePredictions,\n          token\n        } = _ref;\n        setPlacePredictionMenu({\n          items: placePredictions.map(item => ({\n            id: item.place_id,\n            primary: item.structured_formatting.main_text,\n            secondary: [item.structured_formatting.secondary_text]\n          })),\n          emptyText: t('location_not_found_text'),\n          onItemClick: itemId => getPlaceById(itemId, token).then(arg => {\n            setFilterValue('');\n            onSelect?.(arg);\n          })\n        });\n      }).catch(error => {\n        setPlacePredictionMenu({\n          items: []\n        });\n        onError?.(error);\n      });\n    } else {\n      setPlacePredictionMenu({\n        items: []\n      });\n    }\n  }, [filterValue, bias, onError, onSelect]);\n  const onInputChange = useCallback(e => {\n    setFilterValue(e.target.value);\n    onChange?.(e.target.value);\n  }, [onChange]);\n  const onMapClick = useCallback(placeInfo => {\n    onSelect?.(placeInfo);\n    onClick?.(placeInfo);\n  }, [onSelect, onClick]);\n  const Comp = _jsxs(_Fragment, {\n    children: [_jsx(ComboBox, {\n      \"data-testid\": testIds.control,\n      placeholder: t('location_input_placeholder'),\n      menu: filterValue ? {\n        ...placePredictionMenu,\n        items: placePredictionMenu.items.concat({\n          id: createUID(),\n          primary: t('use_input_value', [filterValue])\n        }),\n        mode: 'action',\n        footer: !showMap && _jsx(Flex, {\n          container: {\n            justify: 'end'\n          },\n          children: _jsx(PoweredByGoogleImage, {})\n        })\n      } : undefined,\n      actions: !disabled && !readOnly && _jsx(CurrentLocationButton, {\n        ...{\n          defaultToCurrentLocation,\n          onError,\n          onChange: onSelect\n        }\n      }),\n      onChange: onInputChange,\n      onBlur: () => {\n        setFilterValue('');\n        onBlur?.(value);\n      },\n      value: value,\n      ...{\n        required,\n        disabled,\n        readOnly,\n        status,\n        ...restProps\n      }\n    }), showMap && _jsx(StyledLocationMap, {\n      children: _jsx(LocationView, {\n        ...{\n          location,\n          onClick: onMapClick,\n          onError,\n          bias,\n          disabled,\n          readOnly,\n          centerMapOnChange,\n          height,\n          zoomLevel\n        }\n      })\n    })]\n  });\n  return label ? _jsx(FormField, {\n    ...{\n      testId: testIds,\n      label,\n      labelHidden,\n      id,\n      info,\n      status,\n      ref,\n      required,\n      disabled,\n      additionalInfo\n    },\n    children: Comp\n  }) : Comp;\n});\nexport default LocationInput;","map":{"version":3,"names":["forwardRef","useCallback","useContext","useEffect","useState","styled","ComboBox","useI18n","useTestIds","createUID","FormField","Flex","PoweredByGoogleImage","CurrentLocationButton","MapsContext","getPlaceById","getPlacePredictions","loadMapsAPI","LocationView","StyledLocationView","getLocationInputTestIds","StyledLocationMap","div","LocationInput","props","ref","testId","label","labelHidden","id","location","value","info","status","required","readOnly","disabled","additionalInfo","onSelect","onError","onChange","bias","showMap","defaultToCurrentLocation","centerMapOnChange","height","zoomLevel","onClick","onBlur","restProps","testIds","name","providerOpts","t","placePredictionMenu","setPlacePredictionMenu","items","filterValue","setFilterValue","mapApiPromise","catch","error","then","_ref","placePredictions","token","map","item","place_id","primary","structured_formatting","main_text","secondary","secondary_text","emptyText","onItemClick","itemId","arg","onInputChange","e","target","onMapClick","placeInfo","Comp","_jsxs","_Fragment","children","_jsx","control","placeholder","menu","concat","mode","footer","container","justify","undefined","actions"],"sources":["/Users/dasp10/Documents/KT_project/go-mechanic/client/node_modules/@pega/cosmos-react-core/src/components/Location/LocationInput.tsx"],"sourcesContent":["import {\n  ChangeEvent,\n  FC,\n  forwardRef,\n  PropsWithoutRef,\n  Ref,\n  useCallback,\n  useContext,\n  useEffect,\n  useState\n} from 'react';\nimport styled from 'styled-components';\n\nimport ComboBox from '../ComboBox';\nimport { MenuProps } from '../Menu';\nimport { useI18n, useTestIds } from '../../hooks';\nimport { createUID } from '../../utils';\nimport FormField from '../FormField';\nimport { FormControlProps } from '../FormControl';\nimport { BaseProps, ForwardProps, TestIdProp } from '../../types';\nimport Flex from '../Flex';\n\nimport PoweredByGoogleImage from './PoweredByGoogleImage';\nimport CurrentLocationButton from './CurrentLocationButton';\nimport MapsContext from './MapsContext';\nimport { getPlaceById, getPlacePredictions, loadMapsAPI } from './utils';\nimport BaseLocationProps from './Location.types';\nimport { LatLng } from './types';\nimport LocationView, { LocationViewProps, StyledLocationView } from './LocationView';\nimport { getLocationInputTestIds } from './Location.test-ids';\n\nexport interface LocationInputProps\n  extends LocationViewProps,\n    BaseLocationProps,\n    BaseProps,\n    FormControlProps,\n    TestIdProp {\n  /** Button when clicked will show additional information for the location input */\n  additionalInfo?: FormControlProps['additionalInfo'];\n  /**\n   * Get user current location on component first render.\n   * @default false\n   */\n  defaultToCurrentLocation?: boolean;\n  /** The value of the location field. */\n  value?: string;\n  /**\n   * Callback fired on every change of the location input.\n   * The argument passed back is the component's value prop.\n   */\n  onChange?: (value: string) => void;\n  /**\n   * Callback fired when the control's input loses focus.\n   * The argument passed back is the component's value prop.\n   */\n  onBlur?: (value: string) => void;\n  /**\n   * Set to true renders the map view below input.\n   * @default false\n   */\n  showMap?: boolean;\n  /** Location coordinates used for the map view. */\n  location?: LatLng | string;\n  /** Callback fired when user chooses location from the dropdown of suggestions or submits input value. */\n  onSelect?: (value: {\n    name?: string;\n    address?: string;\n    latitude?: number;\n    longitude?: number;\n  }) => void;\n}\n\nconst StyledLocationMap = styled.div`\n  ${StyledLocationView} {\n    border-top-left-radius: 0;\n    border-top-right-radius: 0;\n  }\n`;\n\nconst LocationInput: FC<LocationInputProps & ForwardProps> = forwardRef(\n  (props: PropsWithoutRef<LocationInputProps>, ref: Ref<HTMLInputElement>) => {\n    const {\n      testId,\n      label,\n      labelHidden,\n      id = createUID(),\n      location = '',\n      value = '',\n      info,\n      status,\n      required,\n      readOnly,\n      disabled,\n      additionalInfo,\n      onSelect,\n      onError,\n      onChange,\n      bias,\n      showMap,\n      defaultToCurrentLocation,\n      centerMapOnChange,\n      height,\n      zoomLevel,\n      onClick,\n      onBlur,\n      ...restProps\n    } = props;\n\n    const testIds = useTestIds(testId, getLocationInputTestIds);\n\n    const { name, ...providerOpts } = useContext(MapsContext);\n    const t = useI18n();\n    const [placePredictionMenu, setPlacePredictionMenu] = useState<MenuProps>({ items: [] });\n    const [filterValue, setFilterValue] = useState('');\n\n    useEffect(() => {\n      const mapApiPromise = loadMapsAPI(name, providerOpts).catch(error => onError?.(error));\n\n      if (filterValue) {\n        mapApiPromise\n          .then(() => getPlacePredictions(filterValue, bias))\n          .then(({ placePredictions, token }) => {\n            setPlacePredictionMenu({\n              items: placePredictions.map(item => ({\n                id: item.place_id,\n                primary: item.structured_formatting.main_text,\n                secondary: [item.structured_formatting.secondary_text]\n              })),\n              emptyText: t('location_not_found_text'),\n              onItemClick: itemId =>\n                getPlaceById(itemId, token).then(arg => {\n                  setFilterValue('');\n                  onSelect?.(arg);\n                })\n            });\n          })\n          .catch(error => {\n            setPlacePredictionMenu({ items: [] });\n            onError?.(error);\n          });\n      } else {\n        setPlacePredictionMenu({ items: [] });\n      }\n    }, [filterValue, bias, onError, onSelect]);\n\n    const onInputChange = useCallback(\n      (e: ChangeEvent<HTMLInputElement>) => {\n        setFilterValue(e.target.value);\n        onChange?.(e.target.value);\n      },\n      [onChange]\n    );\n\n    const onMapClick = useCallback(\n      (placeInfo: { latitude: number; longitude: number; name?: string; address?: string }) => {\n        onSelect?.(placeInfo);\n        onClick?.(placeInfo);\n      },\n      [onSelect, onClick]\n    );\n\n    const Comp = (\n      <>\n        <ComboBox\n          data-testid={testIds.control}\n          placeholder={t('location_input_placeholder')}\n          menu={\n            filterValue\n              ? {\n                  ...placePredictionMenu,\n                  items: placePredictionMenu.items.concat({\n                    id: createUID(),\n                    primary: t('use_input_value', [filterValue])\n                  }),\n                  mode: 'action',\n                  footer: !showMap && (\n                    <Flex container={{ justify: 'end' }}>\n                      <PoweredByGoogleImage />\n                    </Flex>\n                  )\n                }\n              : undefined\n          }\n          actions={\n            !disabled &&\n            !readOnly && (\n              <CurrentLocationButton\n                {...{ defaultToCurrentLocation, onError, onChange: onSelect }}\n              />\n            )\n          }\n          onChange={onInputChange}\n          onBlur={() => {\n            setFilterValue('');\n            onBlur?.(value);\n          }}\n          value={value}\n          {...{\n            required,\n            disabled,\n            readOnly,\n            status,\n            ...restProps\n          }}\n        />\n        {showMap && (\n          <StyledLocationMap>\n            <LocationView\n              {...{\n                location,\n                onClick: onMapClick,\n                onError,\n                bias,\n                disabled,\n                readOnly,\n                centerMapOnChange,\n                height,\n                zoomLevel\n              }}\n            />\n          </StyledLocationMap>\n        )}\n      </>\n    );\n\n    return label ? (\n      <FormField\n        {...{\n          testId: testIds,\n          label,\n          labelHidden,\n          id,\n          info,\n          status,\n          ref,\n          required,\n          disabled,\n          additionalInfo\n        }}\n      >\n        {Comp}\n      </FormField>\n    ) : (\n      Comp\n    );\n  }\n);\n\nexport default LocationInput;\n"],"mappings":";AAAA,SAGEA,UAAU,EAGVC,WAAW,EACXC,UAAU,EACVC,SAAS,EACTC,QAAQ,QACH,OAAO;AACd,OAAOC,MAAM,MAAM,mBAAmB;AAEtC,OAAOC,QAAQ,MAAM,aAAa;AAElC,SAASC,OAAO,EAAEC,UAAU,QAAQ,aAAa;AACjD,SAASC,SAAS,QAAQ,aAAa;AACvC,OAAOC,SAAS,MAAM,cAAc;AAGpC,OAAOC,IAAI,MAAM,SAAS;AAE1B,OAAOC,oBAAoB,MAAM,wBAAwB;AACzD,OAAOC,qBAAqB,MAAM,yBAAyB;AAC3D,OAAOC,WAAW,MAAM,eAAe;AACvC,SAASC,YAAY,EAAEC,mBAAmB,EAAEC,WAAW,QAAQ,SAAS;AAGxE,OAAOC,YAAY,IAAuBC,kBAAkB,QAAQ,gBAAgB;AACpF,SAASC,uBAAuB,QAAQ,qBAAqB;AA2C7D,MAAMC,iBAAiB,GAAGhB,MAAM,CAACiB,GAAG;IAChCH,kBAAkB;;;;CAIrB;AAED,MAAMI,aAAa,GAA0CvB,UAAU,CACrE,CAACwB,KAA0C,EAAEC,GAA0B,KAAI;EACzE,MAAM;IACJC,MAAM;IACNC,KAAK;IACLC,WAAW;IACXC,EAAE,GAAGpB,SAAS,EAAE;IAChBqB,QAAQ,GAAG,EAAE;IACbC,KAAK,GAAG,EAAE;IACVC,IAAI;IACJC,MAAM;IACNC,QAAQ;IACRC,QAAQ;IACRC,QAAQ;IACRC,cAAc;IACdC,QAAQ;IACRC,OAAO;IACPC,QAAQ;IACRC,IAAI;IACJC,OAAO;IACPC,wBAAwB;IACxBC,iBAAiB;IACjBC,MAAM;IACNC,SAAS;IACTC,OAAO;IACPC,MAAM;IACN,GAAGC;EAAS,CACb,GAAGzB,KAAK;EAET,MAAM0B,OAAO,GAAG1C,UAAU,CAACkB,MAAM,EAAEN,uBAAuB,CAAC;EAE3D,MAAM;IAAE+B,IAAI;IAAE,GAAGC;EAAY,CAAE,GAAGlD,UAAU,CAACY,WAAW,CAAC;EACzD,MAAMuC,CAAC,GAAG9C,OAAO,EAAE;EACnB,MAAM,CAAC+C,mBAAmB,EAAEC,sBAAsB,CAAC,GAAGnD,QAAQ,CAAY;IAAEoD,KAAK,EAAE;EAAE,CAAE,CAAC;EACxF,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAGtD,QAAQ,CAAC,EAAE,CAAC;EAElDD,SAAS,CAAC,MAAK;IACb,MAAMwD,aAAa,GAAG1C,WAAW,CAACkC,IAAI,EAAEC,YAAY,CAAC,CAACQ,KAAK,CAACC,KAAK,IAAItB,OAAO,GAAGsB,KAAK,CAAC,CAAC;IAEtF,IAAIJ,WAAW,EAAE;MACfE,aAAa,CACVG,IAAI,CAAC,MAAM9C,mBAAmB,CAACyC,WAAW,EAAEhB,IAAI,CAAC,CAAC,CAClDqB,IAAI,CAACC,IAAA,IAAgC;QAAA,IAA/B;UAAEC,gBAAgB;UAAEC;QAAK,CAAE,GAAAF,IAAA;QAChCR,sBAAsB,CAAC;UACrBC,KAAK,EAAEQ,gBAAgB,CAACE,GAAG,CAACC,IAAI,KAAK;YACnCtC,EAAE,EAAEsC,IAAI,CAACC,QAAQ;YACjBC,OAAO,EAAEF,IAAI,CAACG,qBAAqB,CAACC,SAAS;YAC7CC,SAAS,EAAE,CAACL,IAAI,CAACG,qBAAqB,CAACG,cAAc;WACtD,CAAC,CAAC;UACHC,SAAS,EAAErB,CAAC,CAAC,yBAAyB,CAAC;UACvCsB,WAAW,EAAEC,MAAM,IACjB7D,YAAY,CAAC6D,MAAM,EAAEX,KAAK,CAAC,CAACH,IAAI,CAACe,GAAG,IAAG;YACrCnB,cAAc,CAAC,EAAE,CAAC;YAClBpB,QAAQ,GAAGuC,GAAG,CAAC;UACjB,CAAC;SACJ,CAAC;MACJ,CAAC,CAAC,CACDjB,KAAK,CAACC,KAAK,IAAG;QACbN,sBAAsB,CAAC;UAAEC,KAAK,EAAE;QAAE,CAAE,CAAC;QACrCjB,OAAO,GAAGsB,KAAK,CAAC;MAClB,CAAC,CAAC;KACL,MAAM;MACLN,sBAAsB,CAAC;QAAEC,KAAK,EAAE;MAAE,CAAE,CAAC;;EAEzC,CAAC,EAAE,CAACC,WAAW,EAAEhB,IAAI,EAAEF,OAAO,EAAED,QAAQ,CAAC,CAAC;EAE1C,MAAMwC,aAAa,GAAG7E,WAAW,CAC9B8E,CAAgC,IAAI;IACnCrB,cAAc,CAACqB,CAAC,CAACC,MAAM,CAACjD,KAAK,CAAC;IAC9BS,QAAQ,GAAGuC,CAAC,CAACC,MAAM,CAACjD,KAAK,CAAC;EAC5B,CAAC,EACD,CAACS,QAAQ,CAAC,CACX;EAED,MAAMyC,UAAU,GAAGhF,WAAW,CAC3BiF,SAAmF,IAAI;IACtF5C,QAAQ,GAAG4C,SAAS,CAAC;IACrBnC,OAAO,GAAGmC,SAAS,CAAC;EACtB,CAAC,EACD,CAAC5C,QAAQ,EAAES,OAAO,CAAC,CACpB;EAED,MAAMoC,IAAI,GACRC,KAAA,CAAAC,SAAA;IAAAC,QAAA,GACEC,IAAA,CAACjF,QAAQ;MAAA,eACM4C,OAAO,CAACsC,OAAO;MAC5BC,WAAW,EAAEpC,CAAC,CAAC,4BAA4B,CAAC;MAC5CqC,IAAI,EACFjC,WAAW,GACP;QACE,GAAGH,mBAAmB;QACtBE,KAAK,EAAEF,mBAAmB,CAACE,KAAK,CAACmC,MAAM,CAAC;UACtC9D,EAAE,EAAEpB,SAAS,EAAE;UACf4D,OAAO,EAAEhB,CAAC,CAAC,iBAAiB,EAAE,CAACI,WAAW,CAAC;SAC5C,CAAC;QACFmC,IAAI,EAAE,QAAQ;QACdC,MAAM,EAAE,CAACnD,OAAO,IACd6C,IAAA,CAAC5E,IAAI;UAACmF,SAAS,EAAE;YAAEC,OAAO,EAAE;UAAK,CAAE;UAAAT,QAAA,EACjCC,IAAA,CAAC3E,oBAAoB;QAAG;OAG7B,GACDoF,SAAS;MAEfC,OAAO,EACL,CAAC7D,QAAQ,IACT,CAACD,QAAQ,IACPoD,IAAA,CAAC1E,qBAAqB;QAAA,GAChB;UAAE8B,wBAAwB;UAAEJ,OAAO;UAAEC,QAAQ,EAAEF;QAAQ;MAAE,EAEhE;MAEHE,QAAQ,EAAEsC,aAAa;MACvB9B,MAAM,EAAEA,CAAA,KAAK;QACXU,cAAc,CAAC,EAAE,CAAC;QAClBV,MAAM,GAAGjB,KAAK,CAAC;MACjB,CAAC;MACDA,KAAK,EAAEA,KAAK;MAAA,GACR;QACFG,QAAQ;QACRE,QAAQ;QACRD,QAAQ;QACRF,MAAM;QACN,GAAGgB;;IACJ,EACD,EACDP,OAAO,IACN6C,IAAA,CAAClE,iBAAiB;MAAAiE,QAAA,EAChBC,IAAA,CAACrE,YAAY;QAAA,GACP;UACFY,QAAQ;UACRiB,OAAO,EAAEkC,UAAU;UACnB1C,OAAO;UACPE,IAAI;UACJL,QAAQ;UACRD,QAAQ;UACRS,iBAAiB;UACjBC,MAAM;UACNC;;MACD;IACD,EAEL;EAAA,EAEJ;EAED,OAAOnB,KAAK,GACV4D,IAAA,CAAC7E,SAAS;IAAA,GACJ;MACFgB,MAAM,EAAEwB,OAAO;MACfvB,KAAK;MACLC,WAAW;MACXC,EAAE;MACFG,IAAI;MACJC,MAAM;MACNR,GAAG;MACHS,QAAQ;MACRE,QAAQ;MACRC;KACD;IAAAiD,QAAA,EAEAH;EAAI,EACK,GAEZA,IACD;AACH,CAAC,CACF;AAED,eAAe5D,aAAa"},"metadata":{},"sourceType":"module","externalDependencies":[]}