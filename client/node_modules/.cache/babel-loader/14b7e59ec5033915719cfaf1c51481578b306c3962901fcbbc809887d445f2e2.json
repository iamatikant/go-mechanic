{"ast":null,"code":"import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { createElement as _createElement } from \"react\";\nimport { forwardRef, useContext, useEffect, useRef, useState, useMemo, useCallback, useLayoutEffect } from 'react';\nimport { useAfterInitialEffect, useConsolidatedRef, useItemIntersection } from '../../hooks';\nimport Progress from '../Progress';\nimport EmptyState from '../EmptyState';\nimport Popover from '../Popover';\nimport MenuContext from './Menu.context';\nimport MenuItem from './MenuItem';\nimport { StyledLoadingItem, StyledMenuList, StyledFlyoutMenuListContainer } from './Menu.styles';\nimport { resizeRootEl } from './NavItemsList';\nimport helpers from './helpers';\nimport MenuGroup from './MenuGroup';\nconst FlyoutMenuList = forwardRef((_ref, ref) => {\n  let {\n    items,\n    parent,\n    menuRole\n  } = _ref;\n  const selfRef = useConsolidatedRef(ref);\n  const ulRef = useRef(null);\n  const menuListWrapperRef = useRef(null);\n  const returnFocusRef = useRef(null);\n  const [expandedItem, setExpandedItem] = useState();\n  const {\n    componentId,\n    loadMore,\n    loading,\n    scrollAt,\n    emptyText,\n    onItemExpand,\n    pushFlyoutId,\n    flyOutActiveIdStack,\n    updateActiveDescendants,\n    updateParentDescendantStack\n  } = useContext(MenuContext);\n  useItemIntersection(ulRef, items.length - 1, () => {\n    loadMore?.(parent?.item?.id);\n  }, ':scope > li');\n  useAfterInitialEffect(() => {\n    if (expandedItem) {\n      setExpandedItem(items.find(item => item.id === expandedItem.id)); // FIXME\n    }\n  }, [expandedItem, items]);\n  useEffect(() => {\n    const hasExpanded = items.some(item => {\n      return flyOutActiveIdStack.includes(item.id);\n    });\n    if (!hasExpanded) {\n      returnFocusRef.current = null;\n      setExpandedItem(undefined);\n    }\n  }, [flyOutActiveIdStack]);\n  const listContent = useMemo(() => {\n    if (items.length) {\n      return items.map(item => {\n        return helpers.isItem(item) ? _createElement(MenuItem, {\n          ...item,\n          key: item.id,\n          \"aria-haspopup\": !!item.items,\n          \"aria-expanded\": item.id === expandedItem?.id,\n          role: menuRole === 'listbox' ? 'option' : 'menuitem',\n          onExpand: (id, e) => {\n            if (item.items) {\n              returnFocusRef.current = e.currentTarget;\n              setExpandedItem(item); // FIXME\n              item?.onExpand?.(id, e);\n              onItemExpand?.(id, e);\n              pushFlyoutId(item.id || componentId);\n              updateActiveDescendants();\n              if (updateParentDescendantStack) {\n                updateParentDescendantStack(returnFocusRef.current.closest('li'));\n              }\n            } else {\n              returnFocusRef.current = null;\n              setExpandedItem(undefined);\n            }\n          }\n        }) : _createElement(MenuGroup, {\n          ...item,\n          key: item.id,\n          itemRole: menuRole === 'listbox' ? 'option' : 'menuitem'\n        });\n      });\n    }\n    if (!loading) {\n      return _jsx(EmptyState, {\n        message: emptyText,\n        forwardedAs: 'li'\n      });\n    }\n    return null;\n  }, [items, loading, emptyText, expandedItem, flyOutActiveIdStack]);\n  const list = _jsxs(StyledMenuList, {\n    ref: ulRef,\n    role: menuRole,\n    children: [listContent, loading && !expandedItem && _jsx(StyledLoadingItem, {\n      children: _jsx(Progress, {\n        placement: 'local'\n      })\n    })]\n  });\n  useLayoutEffect(() => {\n    setExpandedItem(undefined);\n    if (selfRef.current) {\n      menuListWrapperRef.current = selfRef.current.parentElement;\n      resizeRootEl(selfRef.current, selfRef.current, items.length, scrollAt);\n    }\n  }, [items]);\n  const handleMenuListScroll = useCallback(() => {\n    if (expandedItem) {\n      setExpandedItem(undefined);\n    }\n  }, [expandedItem]);\n  return _jsxs(_Fragment, {\n    children: [_jsx(StyledFlyoutMenuListContainer, {\n      ref: selfRef,\n      onScroll: handleMenuListScroll,\n      \"data-flyout-menu-parent-id\": componentId,\n      \"data-flyout-menu-id\": parent?.item.id || componentId,\n      children: list\n    }), expandedItem && selfRef.current && _jsx(Popover, {\n      target: returnFocusRef.current,\n      show: true,\n      strategy: 'fixed',\n      placement: 'right-start',\n      children: _jsx(FlyoutMenuList, {\n        items: expandedItem.items,\n        parent: {\n          el: selfRef.current,\n          item: expandedItem,\n          siblingItems: items,\n          setExpandedItem,\n          returnFocusRef\n        },\n        menuRole: menuRole\n      })\n    })]\n  });\n});\nexport default FlyoutMenuList;","map":{"version":3,"names":["forwardRef","useContext","useEffect","useRef","useState","useMemo","useCallback","useLayoutEffect","useAfterInitialEffect","useConsolidatedRef","useItemIntersection","Progress","EmptyState","Popover","MenuContext","MenuItem","StyledLoadingItem","StyledMenuList","StyledFlyoutMenuListContainer","resizeRootEl","helpers","MenuGroup","FlyoutMenuList","_ref","ref","items","parent","menuRole","selfRef","ulRef","menuListWrapperRef","returnFocusRef","expandedItem","setExpandedItem","componentId","loadMore","loading","scrollAt","emptyText","onItemExpand","pushFlyoutId","flyOutActiveIdStack","updateActiveDescendants","updateParentDescendantStack","length","item","id","find","hasExpanded","some","includes","current","undefined","listContent","map","isItem","_createElement","key","role","onExpand","e","currentTarget","closest","itemRole","_jsx","message","forwardedAs","list","_jsxs","children","placement","parentElement","handleMenuListScroll","_Fragment","onScroll","target","show","strategy","el","siblingItems"],"sources":["/Users/dasp10/Documents/KT_project/go-mechanic/client/node_modules/@pega/cosmos-react-core/src/components/Menu/FlyoutMenuList.tsx"],"sourcesContent":["import {\n  forwardRef,\n  FunctionComponent,\n  MutableRefObject,\n  PropsWithoutRef,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n  useMemo,\n  useCallback,\n  useLayoutEffect\n} from 'react';\n\nimport { ForwardProps } from '../../types';\nimport { useAfterInitialEffect, useConsolidatedRef, useItemIntersection } from '../../hooks';\nimport Progress from '../Progress';\nimport EmptyState from '../EmptyState';\nimport Popover from '../Popover';\n\nimport { MenuListProps, ParentMenuItemProps } from './Menu.types';\nimport MenuContext from './Menu.context';\nimport MenuItem from './MenuItem';\nimport { StyledLoadingItem, StyledMenuList, StyledFlyoutMenuListContainer } from './Menu.styles';\nimport { resizeRootEl } from './NavItemsList';\nimport helpers from './helpers';\nimport MenuGroup from './MenuGroup';\n\nconst FlyoutMenuList: FunctionComponent<MenuListProps & ForwardProps> = forwardRef(\n  ({ items, parent, menuRole }: PropsWithoutRef<MenuListProps>, ref: MenuListProps['ref']) => {\n    const selfRef = useConsolidatedRef(ref);\n    const ulRef = useRef<HTMLUListElement>(null);\n    const menuListWrapperRef: MutableRefObject<HTMLElement | null> = useRef(null);\n    const returnFocusRef: MutableRefObject<HTMLButtonElement | null> = useRef(null);\n    const [expandedItem, setExpandedItem] = useState<ParentMenuItemProps>();\n    const {\n      componentId,\n      loadMore,\n      loading,\n      scrollAt,\n      emptyText,\n      onItemExpand,\n      pushFlyoutId,\n      flyOutActiveIdStack,\n      updateActiveDescendants,\n      updateParentDescendantStack\n    } = useContext(MenuContext);\n\n    useItemIntersection(\n      ulRef,\n      items.length - 1,\n      () => {\n        loadMore?.(parent?.item?.id);\n      },\n      ':scope > li'\n    );\n\n    useAfterInitialEffect(() => {\n      if (expandedItem) {\n        setExpandedItem(items.find(item => item.id === expandedItem.id) as ParentMenuItemProps); // FIXME\n      }\n    }, [expandedItem, items]);\n\n    useEffect(() => {\n      const hasExpanded = items.some(item => {\n        return flyOutActiveIdStack.includes(item.id);\n      });\n\n      if (!hasExpanded) {\n        returnFocusRef.current = null;\n        setExpandedItem(undefined);\n      }\n    }, [flyOutActiveIdStack]);\n\n    const listContent = useMemo(() => {\n      if (items.length) {\n        return items.map(item => {\n          return helpers.isItem(item) ? (\n            <MenuItem\n              {...item}\n              key={item.id}\n              aria-haspopup={!!item.items}\n              aria-expanded={item.id === expandedItem?.id}\n              role={menuRole === 'listbox' ? 'option' : 'menuitem'}\n              onExpand={(id, e) => {\n                if (item.items) {\n                  returnFocusRef.current = e.currentTarget as HTMLButtonElement;\n                  setExpandedItem(item as ParentMenuItemProps); // FIXME\n                  item?.onExpand?.(id, e);\n                  onItemExpand?.(id, e);\n                  pushFlyoutId(item.id || componentId);\n                  updateActiveDescendants();\n                  if (updateParentDescendantStack) {\n                    updateParentDescendantStack(returnFocusRef.current.closest('li'));\n                  }\n                } else {\n                  returnFocusRef.current = null;\n                  setExpandedItem(undefined);\n                }\n              }}\n            />\n          ) : (\n            <MenuGroup\n              {...item}\n              key={item.id}\n              itemRole={menuRole === 'listbox' ? 'option' : 'menuitem'}\n            />\n          );\n        });\n      }\n\n      if (!loading) {\n        return <EmptyState message={emptyText} forwardedAs='li' />;\n      }\n\n      return null;\n    }, [items, loading, emptyText, expandedItem, flyOutActiveIdStack]);\n\n    const list = (\n      <StyledMenuList ref={ulRef} role={menuRole}>\n        {listContent}\n        {loading && !expandedItem && (\n          <StyledLoadingItem>\n            <Progress placement='local' />\n          </StyledLoadingItem>\n        )}\n      </StyledMenuList>\n    );\n\n    useLayoutEffect(() => {\n      setExpandedItem(undefined);\n      if (selfRef.current) {\n        menuListWrapperRef.current = selfRef.current.parentElement;\n        resizeRootEl(selfRef.current, selfRef.current, items.length, scrollAt);\n      }\n    }, [items]);\n\n    const handleMenuListScroll = useCallback(() => {\n      if (expandedItem) {\n        setExpandedItem(undefined);\n      }\n    }, [expandedItem]);\n\n    return (\n      <>\n        <StyledFlyoutMenuListContainer\n          ref={selfRef}\n          onScroll={handleMenuListScroll}\n          data-flyout-menu-parent-id={componentId}\n          data-flyout-menu-id={parent?.item.id || componentId}\n        >\n          {list}\n        </StyledFlyoutMenuListContainer>\n\n        {expandedItem && selfRef.current && (\n          <Popover target={returnFocusRef.current} show strategy='fixed' placement='right-start'>\n            <FlyoutMenuList\n              items={expandedItem.items}\n              parent={{\n                el: selfRef.current,\n                item: expandedItem,\n                siblingItems: items,\n                setExpandedItem,\n                returnFocusRef\n              }}\n              menuRole={menuRole}\n            />\n          </Popover>\n        )}\n      </>\n    );\n  }\n);\n\nexport default FlyoutMenuList;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}