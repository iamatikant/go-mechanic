{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useEffect, useRef, useMemo, useContext } from 'react';\nimport { Shortcuts } from 'shortcuts';\nimport { useAfterInitialEffect } from '../../hooks';\nimport { windowIsAvailable } from '../../utils';\nimport { ShortcutManagerContext } from './Context';\nconst actionRegistry = new Map();\n/**\n * Function to register an action triggerable using a shortcut. All actions must be registered before\n * binding a callback.\n * @param actions actions with definitions to be registered.\n */\nexport const registerAction = function () {\n  for (var _len = arguments.length, actions = new Array(_len), _key = 0; _key < _len; _key++) {\n    actions[_key] = arguments[_key];\n  }\n  actions.forEach(_ref => {\n    let {\n      id,\n      defaultKeyBinding: defaultShortcut\n    } = _ref;\n    if (!actionRegistry.has(id)) {\n      actionRegistry.set(id, {\n        defaultKeyBinding: defaultShortcut\n      });\n    }\n  });\n};\nconst dispatchShortcutEvent = (actionId, e) => {\n  const shortcutEvent = new CustomEvent('shortcut', {\n    bubbles: true,\n    detail: {\n      actionId\n    }\n  });\n  e.target?.dispatchEvent(shortcutEvent);\n};\nconst ShortcutManager = _ref2 => {\n  let {\n    children,\n    target,\n    bindings: customBindings = {}\n  } = _ref2;\n  const shortcutsRef = useRef();\n  const bindings = Object.fromEntries(Array.from(actionRegistry.entries()).map(_ref3 => {\n    let [action, actionDef] = _ref3;\n    return [action, customBindings[action] ?? actionDef.defaultKeyBinding];\n  }));\n  const context = windowIsAvailable ? window.cosmos.shortcutManagerContext ?? ShortcutManagerContext : ShortcutManagerContext;\n  const priorCtxValue = useContext(context);\n  useEffect(() => {\n    // bail out if ShortcutManager has been initialized\n    if (priorCtxValue.initialized) return;\n    shortcutsRef.current = new Shortcuts({\n      target,\n      shouldHandleEvent: e =>\n      // both 'keydown' and 'keypress' events are handled by default ('shortcuts' bug?)\n      e.type === 'keydown' && !e.defaultPrevented &&\n      // don't process event during typing letters/digits into inputs without modifier keys\n      !(e.target instanceof HTMLElement && ['input', 'textarea'].includes(e.target.nodeName.toLowerCase()) && e.key.match(/a-zA-Z0-9/) && !['Control', 'Meta'].some(modifier => e.getModifierState(modifier))),\n      shortcuts: Object.entries(bindings).map(_ref4 => {\n        let [action, shortcut] = _ref4;\n        return {\n          shortcut,\n          handler: e => {\n            e.preventDefault();\n            dispatchShortcutEvent(action, e);\n          }\n        };\n      })\n    });\n    return () => {\n      shortcutsRef.current?.reset();\n      shortcutsRef.current = undefined;\n    };\n  }, [target]);\n  useAfterInitialEffect(() => {\n    // bail out if ShortcutManager has been initialized\n    if (priorCtxValue.initialized) return;\n    const shortcutInstance = shortcutsRef.current;\n    if (shortcutInstance) {\n      shortcutInstance.reset();\n      shortcutInstance.add(Object.entries(bindings).map(_ref5 => {\n        let [action, shortcut] = _ref5;\n        return {\n          shortcut,\n          handler: e => dispatchShortcutEvent(action, e)\n        };\n      }));\n    }\n  }, [JSON.stringify(bindings)]);\n  const ctxValue = useMemo(() => ({\n    bindings: Object.freeze(bindings),\n    initialized: true\n  }), [JSON.stringify(bindings)]);\n  if (priorCtxValue.initialized) {\n    return _jsx(context.Provider, {\n      value: priorCtxValue,\n      children: children\n    });\n  }\n  return _jsx(ShortcutManagerContext.Provider, {\n    value: ctxValue,\n    children: children\n  });\n};\nexport default ShortcutManager;","map":{"version":3,"names":["useEffect","useRef","useMemo","useContext","Shortcuts","useAfterInitialEffect","windowIsAvailable","ShortcutManagerContext","actionRegistry","Map","registerAction","_len","arguments","length","actions","Array","_key","forEach","_ref","id","defaultKeyBinding","defaultShortcut","has","set","dispatchShortcutEvent","actionId","e","shortcutEvent","CustomEvent","bubbles","detail","target","dispatchEvent","ShortcutManager","_ref2","children","bindings","customBindings","shortcutsRef","Object","fromEntries","from","entries","map","_ref3","action","actionDef","context","window","cosmos","shortcutManagerContext","priorCtxValue","initialized","current","shouldHandleEvent","type","defaultPrevented","HTMLElement","includes","nodeName","toLowerCase","key","match","some","modifier","getModifierState","shortcuts","_ref4","shortcut","handler","preventDefault","reset","undefined","shortcutInstance","add","_ref5","JSON","stringify","ctxValue","freeze","_jsx","Provider","value"],"sources":["/Users/dasp10/Documents/KT_project/go-mechanic/client/node_modules/@pega/cosmos-react-core/src/components/ShortcutManager/ShortcutManager.tsx"],"sourcesContent":["import { FunctionComponent, useEffect, useRef, useMemo, Context, useContext } from 'react';\nimport { Shortcuts } from 'shortcuts';\n\nimport { useAfterInitialEffect } from '../../hooks';\nimport { windowIsAvailable } from '../../utils';\n\nimport { ShortcutManagerContext, type ShortcutManagerContextValue } from './Context';\nimport type {\n  ShortcutAction,\n  ShortcutActionConfig,\n  ShortcutManagerProps\n} from './ShortcutManager.types';\n\ndeclare module '../../init' {\n  export interface CosmosGlobals {\n    shortcutManagerContext?: Context<ShortcutManagerContextValue>;\n  }\n}\n\nconst actionRegistry = new Map<string, ShortcutActionConfig>();\n\n/**\n * Function to register an action triggerable using a shortcut. All actions must be registered before\n * binding a callback.\n * @param actions actions with definitions to be registered.\n */\nexport const registerAction = (...actions: ShortcutAction[]): void => {\n  actions.forEach(({ id, defaultKeyBinding: defaultShortcut }) => {\n    if (!actionRegistry.has(id)) {\n      actionRegistry.set(id, { defaultKeyBinding: defaultShortcut });\n    }\n  });\n};\n\nconst dispatchShortcutEvent = (actionId: ShortcutAction['id'], e: KeyboardEvent) => {\n  const shortcutEvent = new CustomEvent('shortcut', {\n    bubbles: true,\n    detail: { actionId }\n  });\n  e.target?.dispatchEvent(shortcutEvent);\n};\n\nconst ShortcutManager: FunctionComponent<ShortcutManagerProps> = ({\n  children,\n  target,\n  bindings: customBindings = {}\n}) => {\n  const shortcutsRef = useRef<Shortcuts>();\n\n  const bindings = Object.fromEntries(\n    Array.from(actionRegistry.entries()).map(([action, actionDef]) => [\n      action,\n      customBindings[action] ?? actionDef.defaultKeyBinding\n    ])\n  );\n\n  const context = windowIsAvailable\n    ? window.cosmos.shortcutManagerContext ?? ShortcutManagerContext\n    : ShortcutManagerContext;\n  const priorCtxValue = useContext(context);\n\n  useEffect(() => {\n    // bail out if ShortcutManager has been initialized\n    if (priorCtxValue.initialized) return;\n\n    shortcutsRef.current = new Shortcuts({\n      target,\n      shouldHandleEvent: e =>\n        // both 'keydown' and 'keypress' events are handled by default ('shortcuts' bug?)\n        e.type === 'keydown' &&\n        !e.defaultPrevented &&\n        // don't process event during typing letters/digits into inputs without modifier keys\n        !(\n          e.target instanceof HTMLElement &&\n          ['input', 'textarea'].includes(e.target.nodeName.toLowerCase()) &&\n          e.key.match(/a-zA-Z0-9/) &&\n          !['Control', 'Meta'].some(modifier => e.getModifierState(modifier))\n        ),\n      shortcuts: Object.entries(bindings).map(([action, shortcut]) => ({\n        shortcut,\n        handler: e => {\n          e.preventDefault();\n          dispatchShortcutEvent(action, e);\n        }\n      }))\n    });\n\n    return () => {\n      shortcutsRef.current?.reset();\n      shortcutsRef.current = undefined;\n    };\n  }, [target]);\n\n  useAfterInitialEffect(() => {\n    // bail out if ShortcutManager has been initialized\n    if (priorCtxValue.initialized) return;\n\n    const shortcutInstance = shortcutsRef.current;\n    if (shortcutInstance) {\n      shortcutInstance.reset();\n      shortcutInstance.add(\n        Object.entries(bindings).map(([action, shortcut]) => ({\n          shortcut,\n          handler: e => dispatchShortcutEvent(action, e)\n        }))\n      );\n    }\n  }, [JSON.stringify(bindings)]);\n\n  const ctxValue = useMemo(\n    () => ({\n      bindings: Object.freeze(bindings),\n      initialized: true\n    }),\n    [JSON.stringify(bindings)]\n  );\n\n  if (priorCtxValue.initialized) {\n    return <context.Provider value={priorCtxValue}>{children}</context.Provider>;\n  }\n\n  return (\n    <ShortcutManagerContext.Provider value={ctxValue}>{children}</ShortcutManagerContext.Provider>\n  );\n};\n\nexport default ShortcutManager;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}